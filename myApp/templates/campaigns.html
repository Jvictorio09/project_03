{% extends 'base_internal.html' %}
{% load static %}

{% block title %}Campaigns - KaTek AI{% endblock %}

{% block extra_css %}
<style>
  .campaigns-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: var(--space-8) var(--space-4);
  }
  
  .campaigns-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-8);
  }
  
  .campaigns-title {
    font-size: 2.5rem;
    font-weight: var(--font-weight-bold);
    margin: 0;
  }
  
  .campaigns-actions {
    display: flex;
    gap: var(--space-4);
    align-items: center;
  }
  
  .search-box {
    position: relative;
    min-width: 300px;
  }
  
  .search-input {
    width: 100%;
    padding: var(--space-3) var(--space-4) var(--space-3) var(--space-10);
    background: var(--surface-glass);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: var(--radius-md);
    color: var(--text-primary);
    font-size: 0.875rem;
    backdrop-filter: blur(10px);
  }
  
  .search-input:focus {
    outline: none;
    border-color: var(--primary-purple);
    box-shadow: 0 0 0 3px rgba(109, 40, 217, 0.1);
  }
  
  .search-icon {
    position: absolute;
    left: var(--space-3);
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-muted);
    font-size: 0.875rem;
  }
  
  .campaigns-content {
    display: grid;
    grid-template-columns: 1fr 400px;
    gap: var(--space-8);
  }
  
  .campaigns-list {
    background: var(--surface-glass);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: var(--radius-xl);
    overflow: hidden;
    box-shadow: var(--shadow-soft);
  }
  
  .list-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--space-6);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }
  
  .list-title {
    font-size: 1.25rem;
    font-weight: var(--font-weight-bold);
    margin: 0;
  }
  
  .list-actions {
    display: flex;
    gap: var(--space-3);
    align-items: center;
  }
  
  .campaign-item {
    display: flex;
    align-items: center;
    gap: var(--space-4);
    padding: var(--space-6);
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    transition: background var(--transition-fast);
    cursor: pointer;
  }
  
  .campaign-item:hover {
    background: rgba(255, 255, 255, 0.05);
  }
  
  .campaign-item:last-child {
    border-bottom: none;
  }
  
  .campaign-icon {
    width: 48px;
    height: 48px;
    border-radius: var(--radius-lg);
    background: var(--primary-purple);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.25rem;
    flex-shrink: 0;
  }
  
  .campaign-info {
    flex: 1;
    min-width: 0;
  }
  
  .campaign-name {
    font-size: 1rem;
    font-weight: var(--font-weight-bold);
    color: var(--text-primary);
    margin: 0 0 var(--space-1) 0;
  }
  
  .campaign-description {
    font-size: 0.875rem;
    color: var(--text-secondary);
    margin: 0 0 var(--space-2) 0;
  }
  
  .campaign-meta {
    display: flex;
    gap: var(--space-4);
    font-size: 0.75rem;
    color: var(--text-muted);
  }
  
  .campaign-stats {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: var(--space-1);
  }
  
  .stat-value {
    font-size: 1.125rem;
    font-weight: var(--font-weight-bold);
    color: var(--primary-purple);
  }
  
  .stat-label {
    font-size: 0.75rem;
    color: var(--text-muted);
  }
  
  .campaign-status {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    margin-top: var(--space-2);
  }
  
  .status-badge {
    display: inline-flex;
    align-items: center;
    padding: var(--space-1) var(--space-2);
    border-radius: var(--radius-sm);
    font-size: 0.625rem;
    font-weight: var(--font-weight-medium);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }
  
  .status-draft {
    background: rgba(107, 114, 128, 0.2);
    color: var(--text-muted);
    border: 1px solid rgba(107, 114, 128, 0.3);
  }
  
  .status-scheduled {
    background: rgba(245, 158, 11, 0.2);
    color: var(--warning-amber);
    border: 1px solid rgba(245, 158, 11, 0.3);
  }
  
  .status-sent {
    background: rgba(16, 185, 129, 0.2);
    color: var(--success-emerald);
    border: 1px solid rgba(16, 185, 129, 0.3);
  }
  
  .status-paused {
    background: rgba(239, 68, 68, 0.2);
    color: var(--destructive-rose);
    border: 1px solid rgba(239, 68, 68, 0.3);
  }
  
  .campaign-actions {
    display: flex;
    gap: var(--space-2);
  }
  
  .action-btn {
    padding: var(--space-2);
    background: var(--surface-glass);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: var(--radius-sm);
    color: var(--text-secondary);
    cursor: pointer;
    transition: all var(--transition-fast);
    font-size: 0.75rem;
  }
  
  .action-btn:hover {
    background: var(--surface-glass-hover);
    border-color: rgba(255, 255, 255, 0.3);
    color: var(--text-primary);
  }
  
  .action-btn.primary {
    background: var(--primary-purple);
    border-color: var(--primary-purple);
    color: white;
  }
  
  .action-btn.primary:hover {
    background: var(--primary-purple-hover);
  }
  
  .create-campaign {
    background: var(--surface-glass);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: var(--radius-xl);
    padding: var(--space-6);
    box-shadow: var(--shadow-soft);
    height: fit-content;
    position: sticky;
    top: var(--space-8);
  }
  
  .create-header {
    margin-bottom: var(--space-6);
  }
  
  .create-title {
    font-size: 1.25rem;
    font-weight: var(--font-weight-bold);
    margin: 0 0 var(--space-2) 0;
    color: var(--text-primary);
  }
  
  .create-subtitle {
    font-size: 0.875rem;
    color: var(--text-secondary);
    margin: 0;
  }
  
  .campaign-types {
    display: flex;
    flex-direction: column;
    gap: var(--space-3);
    margin-bottom: var(--space-6);
  }
  
  .campaign-type {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    padding: var(--space-4);
    background: var(--surface-glass);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: var(--radius-lg);
    cursor: pointer;
    transition: all var(--transition-normal);
  }
  
  .campaign-type:hover {
    border-color: var(--primary-purple);
    background: rgba(109, 40, 217, 0.1);
  }
  
  .campaign-type.selected {
    border-color: var(--primary-purple);
    background: rgba(109, 40, 217, 0.2);
  }
  
  .type-icon {
    width: 40px;
    height: 40px;
    border-radius: var(--radius-md);
    background: var(--primary-purple);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1rem;
  }
  
  .type-info h4 {
    margin: 0;
    font-size: 0.875rem;
    font-weight: var(--font-weight-bold);
    color: var(--text-primary);
  }
  
  .type-info p {
    margin: var(--space-1) 0 0 0;
    font-size: 0.75rem;
    color: var(--text-secondary);
  }
  
  .ai-assist {
    background: linear-gradient(135deg, var(--primary-purple), var(--electric-violet));
    border-radius: var(--radius-lg);
    padding: var(--space-4);
    margin-bottom: var(--space-6);
    color: white;
  }
  
  .ai-assist-header {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    margin-bottom: var(--space-3);
  }
  
  .ai-assist-icon {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.75rem;
  }
  
  .ai-assist-title {
    font-size: 0.875rem;
    font-weight: var(--font-weight-bold);
    margin: 0;
  }
  
  .ai-assist-text {
    font-size: 0.75rem;
    margin: 0;
    opacity: 0.9;
  }
  
  .ai-assist-button {
    width: 100%;
    padding: var(--space-3);
    background: rgba(255, 255, 255, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: var(--radius-md);
    color: white;
    font-size: 0.875rem;
    font-weight: var(--font-weight-medium);
    cursor: pointer;
    transition: all var(--transition-normal);
    margin-top: var(--space-3);
  }
  
  .ai-assist-button:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: translateY(-1px);
  }
  
  .quick-stats {
    margin-top: var(--space-6);
    padding-top: var(--space-6);
    border-top: 1px solid rgba(255, 255, 255, 0.1);
  }
  
  .stats-title {
    font-size: 1rem;
    font-weight: var(--font-weight-bold);
    margin-bottom: var(--space-4);
    color: var(--text-primary);
  }
  
  .stats-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--space-4);
  }
  
  .stat-item {
    text-align: center;
    padding: var(--space-3);
    background: var(--surface-glass);
    border-radius: var(--radius-md);
  }
  
  .stat-value {
    font-size: 1.5rem;
    font-weight: var(--font-weight-bold);
    color: var(--primary-purple);
    margin: 0;
  }
  
  .stat-label {
    font-size: 0.75rem;
    color: var(--text-muted);
    margin-top: var(--space-1);
  }
  
  .empty-state {
    text-align: center;
    padding: var(--space-12);
  }
  
  .empty-icon {
    width: 80px;
    height: 80px;
    border-radius: var(--radius-xl);
    background: linear-gradient(135deg, var(--primary-purple), var(--electric-violet));
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto var(--space-4);
    color: white;
    font-size: 2rem;
  }
  
  .empty-title {
    font-size: 1.5rem;
    font-weight: var(--font-weight-bold);
    margin-bottom: var(--space-2);
    color: var(--text-primary);
  }
  
  .empty-description {
    color: var(--text-secondary);
    margin-bottom: var(--space-6);
  }
  
  @media (max-width: 768px) {
    .campaigns-content {
      grid-template-columns: 1fr;
    }
    
    .create-campaign {
      position: static;
      order: -1;
    }
    
    .campaign-item {
      flex-direction: column;
      align-items: flex-start;
      gap: var(--space-3);
    }
    
    .campaign-stats {
      align-items: flex-start;
    }
  }
</style>
{% endblock %}

{% block content %}
<div class="campaigns-container">
  <!-- Header -->
  <div class="campaigns-header">
    <h1 class="campaigns-title">Campaigns</h1>
    <div class="campaigns-actions">
      <div class="search-box">
        <i class="fas fa-search search-icon"></i>
        <input type="text" class="search-input" placeholder="Search campaigns..." id="campaign-search">
      </div>
      <a href="#" class="btn btn-primary" onclick="openCreateModal()">
        <i class="fas fa-plus"></i>
        Create Campaign
      </a>
    </div>
  </div>
  
  <!-- Main Content -->
  <div class="campaigns-content">
    <!-- Campaigns List -->
    <div class="campaigns-list">
      <div class="list-header">
        <h3 class="list-title">All Campaigns ({{ campaigns|length }})</h3>
        <div class="list-actions">
          <button class="btn btn-ghost btn-sm">
            <i class="fas fa-filter"></i>
            Filter
          </button>
          <button class="btn btn-ghost btn-sm">
            <i class="fas fa-download"></i>
            Export
          </button>
        </div>
      </div>
      
      {% if campaigns %}
        {% for campaign in campaigns %}
        <div class="campaign-item" onclick="openCampaignDetails('{{ campaign.id }}')">
          <div class="campaign-icon">
            <i class="fas fa-envelope"></i>
          </div>
          
          <div class="campaign-info">
            <h4 class="campaign-name">{{ campaign.name }}</h4>
            <p class="campaign-description">{{ campaign.description|truncatechars:60 }}</p>
            <div class="campaign-meta">
              <span><i class="fas fa-users"></i> {{ campaign.audience_size }} recipients</span>
              <span><i class="fas fa-calendar"></i> {{ campaign.scheduled_at|date:"M d, Y" }}</span>
              <span><i class="fas fa-tag"></i> {{ campaign.type|title }}</span>
            </div>
            <div class="campaign-status">
              <span class="status-badge status-{{ campaign.status }}">{{ campaign.status|title }}</span>
            </div>
          </div>
          
          <div class="campaign-stats">
            <div class="stat-value">{{ campaign.open_rate }}%</div>
            <div class="stat-label">Open Rate</div>
            <div class="stat-value">{{ campaign.click_rate }}%</div>
            <div class="stat-label">Click Rate</div>
          </div>
          
          <div class="campaign-actions">
            <button class="action-btn" title="Edit">
              <i class="fas fa-edit"></i>
            </button>
            <button class="action-btn" title="Duplicate">
              <i class="fas fa-copy"></i>
            </button>
            <button class="action-btn primary" title="Send Now">
              <i class="fas fa-paper-plane"></i>
            </button>
          </div>
        </div>
        {% endfor %}
      {% else %}
        <div class="empty-state">
          <div class="empty-icon">
            <i class="fas fa-paper-plane"></i>
          </div>
          <h3 class="empty-title">No campaigns yet</h3>
          <p class="empty-description">Create your first email campaign to start engaging with your leads</p>
          <a href="#" class="btn btn-primary" onclick="openCreateModal()">
            <i class="fas fa-plus"></i>
            Create Your First Campaign
          </a>
        </div>
      {% endif %}
    </div>
    
    <!-- Create Campaign Sidebar -->
    <div class="create-campaign">
      <div class="create-header">
        <h3 class="create-title">Create New Campaign</h3>
        <p class="create-subtitle">Choose a campaign type to get started</p>
      </div>
      
      <div class="campaign-types">
        <div class="campaign-type selected" data-type="email">
          <div class="type-icon">
            <i class="fas fa-envelope"></i>
          </div>
          <div class="type-info">
            <h4>Email Campaign</h4>
            <p>Send targeted emails to your leads</p>
          </div>
        </div>
        
        <div class="campaign-type" data-type="sequence">
          <div class="type-icon">
            <i class="fas fa-list-ol"></i>
          </div>
          <div class="type-info">
            <h4>Email Sequence</h4>
            <p>Multi-step automated follow-ups</p>
          </div>
        </div>
        
        <div class="campaign-type" data-type="announcement">
          <div class="type-icon">
            <i class="fas fa-bullhorn"></i>
          </div>
          <div class="type-info">
            <h4>Property Announcement</h4>
            <p>Announce new listings to your network</p>
          </div>
        </div>
      </div>
      
      <div class="ai-assist">
        <div class="ai-assist-header">
          <div class="ai-assist-icon">
            <i class="fas fa-robot"></i>
          </div>
          <h4 class="ai-assist-title">AI Campaign Assistant</h4>
        </div>
        <p class="ai-assist-text">Let AI help you write compelling email content based on your audience and goals.</p>
        <button class="ai-assist-button" onclick="openAIAssistant()">
          <i class="fas fa-magic"></i>
          Generate with AI
        </button>
      </div>
      
      <div class="quick-stats">
        <h4 class="stats-title">Campaign Performance</h4>
        <div class="stats-grid">
          <div class="stat-item">
            <div class="stat-value">24.5%</div>
            <div class="stat-label">Avg Open Rate</div>
          </div>
          <div class="stat-item">
            <div class="stat-value">3.2%</div>
            <div class="stat-label">Avg Click Rate</div>
          </div>
          <div class="stat-item">
            <div class="stat-value">12</div>
            <div class="stat-label">Active Campaigns</div>
          </div>
          <div class="stat-item">
            <div class="stat-value">1,247</div>
            <div class="stat-label">Total Sent</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Create Campaign Modal -->
<div id="create-modal" class="modal" style="display: none;">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Create New Campaign</h3>
      <button class="modal-close" onclick="closeCreateModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body">
      <form id="campaign-form">
        <div class="form-group">
          <label class="form-label">Campaign Name</label>
          <input type="text" name="name" class="form-input" placeholder="Enter campaign name" required>
        </div>
        
        <div class="form-group">
          <label class="form-label">Campaign Type</label>
          <select name="type" class="form-input form-select" required>
            <option value="email">Email Campaign</option>
            <option value="sequence">Email Sequence</option>
            <option value="announcement">Property Announcement</option>
          </select>
        </div>
        
        <div class="form-group">
          <label class="form-label">Audience</label>
          <select name="audience" class="form-input form-select" required>
            <option value="all">All Leads</option>
            <option value="qualified">Qualified Leads Only</option>
            <option value="new">New Leads (Last 30 days)</option>
            <option value="custom">Custom Segment</option>
          </select>
        </div>
        
        <div class="form-group">
          <label class="form-label">Subject Line</label>
          <input type="text" name="subject" class="form-input" placeholder="Enter email subject" required>
        </div>
        
        <div class="form-group">
          <label class="form-label">Email Content</label>
          <textarea name="content" class="form-input form-textarea" placeholder="Write your email content..." rows="8"></textarea>
        </div>
        
        <div class="form-group">
          <label class="form-label">Schedule</label>
          <select name="schedule" class="form-input form-select" required>
            <option value="now">Send Now</option>
            <option value="scheduled">Schedule for Later</option>
            <option value="draft">Save as Draft</option>
          </select>
        </div>
        
        <div class="form-actions">
          <button type="button" class="btn btn-ghost" onclick="closeCreateModal()">Cancel</button>
          <button type="submit" class="btn btn-primary">Create Campaign</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Search functionality
  const searchInput = document.getElementById('campaign-search');
  searchInput.addEventListener('input', function() {
    const searchTerm = this.value.toLowerCase();
    const items = document.querySelectorAll('.campaign-item');
    
    items.forEach(item => {
      const text = item.textContent.toLowerCase();
      if (text.includes(searchTerm)) {
        item.style.display = '';
      } else {
        item.style.display = 'none';
      }
    });
  });
  
  // Campaign type selection
  const campaignTypes = document.querySelectorAll('.campaign-type');
  campaignTypes.forEach(type => {
    type.addEventListener('click', function() {
      campaignTypes.forEach(t => t.classList.remove('selected'));
      this.classList.add('selected');
    });
  });
});

function openCreateModal() {
  document.getElementById('create-modal').style.display = 'flex';
}

function closeCreateModal() {
  document.getElementById('create-modal').style.display = 'none';
}

function openCampaignDetails(campaignId) {
  // Implementation for opening campaign details
  console.log('Opening campaign details for:', campaignId);
}

function openAIAssistant() {
  // Implementation for AI assistant
  console.log('Opening AI assistant...');
}

// Form submission
document.getElementById('campaign-form').addEventListener('submit', function(e) {
  e.preventDefault();
  
  const formData = new FormData(this);
  const campaignData = Object.fromEntries(formData);
  
  console.log('Creating campaign:', campaignData);
  
  // Close modal and show success message
  closeCreateModal();
  showToast('Campaign created successfully!', 'success');
});
</script>
{% endblock %}
