{# AI Text Import Form #}
<form 
  hx-post="{% url 'import_ai' %}"
  hx-target="#add-property-modal .modal-body"
  hx-swap="innerHTML"
  hx-indicator="#ai-import-indicator"
  class="space-y-6">
  {% csrf_token %}
  
  {% if error %}
    <div class="bg-red-500/20 border border-red-500/50 rounded-lg p-4 mb-4">
      <p class="text-red-400">{{ error }}</p>
    </div>
  {% endif %}
  
  <div>
    <label for="property_text" class="block text-sm font-medium text-gray-300 mb-2">
      Paste Property Description *
    </label>
    <textarea 
      name="property_text" 
      id="property_text"
      required
      rows="8"
      class="w-full px-4 py-3 bg-white/5 border border-white/10 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-violet-500 resize-none"
      placeholder="Paste your property listing text here...&#10;&#10;Example:&#10;Luxury 2BR condo in BGC, Makati. $3,500/month. 2 bedrooms, 2 baths. Modern amenities, pool, gym. Contact Maria at 0917-123-4567"></textarea>
    <p class="text-xs text-gray-400 mt-1">AI will automatically extract: price, beds, baths, city, area, and more.</p>
  </div>
  
  <div>
    <label for="image_url" class="block text-sm font-medium text-gray-300 mb-2">
      Primary Image URL (Optional)
    </label>
    <input 
      type="url" 
      name="image_url" 
      id="image_url"
      class="w-full px-4 py-3 bg-white/5 border border-white/10 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-violet-500"
      placeholder="https://example.com/property-image.jpg">
    <p class="text-xs text-gray-400 mt-1">Alternatively, upload an image after import.</p>
  </div>
  
  <div class="flex justify-end gap-3 pt-4 border-t border-white/10">
    <button 
      type="button"
      onclick="document.getElementById('add-property-modal').classList.add('hidden');"
      class="px-6 py-3 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors font-semibold">
      Cancel
    </button>
    <button 
      type="submit"
      id="ai-import-submit"
      class="px-6 py-3 bg-violet-600 hover:bg-violet-700 text-white rounded-lg transition-colors font-semibold disabled:opacity-50 disabled:cursor-not-allowed">
      <span id="ai-import-text">
        <i class="fas fa-magic mr-2"></i> Import with AI
      </span>
      <span id="ai-import-loading" class="hidden">
        <i class="fas fa-spinner fa-spin mr-2"></i> Processing...
      </span>
    </button>
  </div>
  
  <div id="ai-import-indicator" class="htmx-indicator text-center py-4">
    <i class="fas fa-spinner fa-spin text-2xl text-violet-500"></i>
    <p class="text-gray-400 mt-2">AI is analyzing your text...</p>
  </div>
</form>

<script>
// Handle form submission loading state
document.body.addEventListener('htmx:beforeRequest', function(event) {
  if (event.detail.elt.closest('form') && event.detail.elt.closest('form').querySelector('#property_text')) {
    const submitBtn = event.detail.elt.closest('form').querySelector('#ai-import-submit');
    const loadingText = event.detail.elt.closest('form').querySelector('#ai-import-loading');
    const normalText = event.detail.elt.closest('form').querySelector('#ai-import-text');
    if (submitBtn) {
      submitBtn.disabled = true;
      if (normalText) normalText.classList.add('hidden');
      if (loadingText) loadingText.classList.remove('hidden');
    }
  }
});
</script>

