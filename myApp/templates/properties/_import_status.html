{# Processing Status Fragment #}
<div class="status-container">
  <div class="text-center py-8">
    {% if upload.status == 'processing' %}
      <div class="mb-6">
        <i class="fas fa-spinner fa-spin text-4xl text-violet-500 mb-4"></i>
        <h3 class="text-xl font-bold text-white mb-2">Validating Your Property...</h3>
        <p class="text-gray-400">AI is analyzing your listing and extracting information.</p>
      </div>
      
      {% if extracted_preview %}
        <div class="bg-white/5 border border-white/10 rounded-lg p-4 mb-6 text-left">
          <h4 class="text-sm font-semibold text-white mb-3">Extracted Information:</h4>
          <div class="grid grid-cols-2 gap-3 text-sm">
            {% if extracted_preview.title %}
              <div><span class="text-gray-400">Title:</span> <span class="text-white">{{ extracted_preview.title }}</span></div>
            {% endif %}
            {% if extracted_preview.price_amount %}
              <div><span class="text-gray-400">Price:</span> <span class="text-white">${{ extracted_preview.price_amount|floatformat:0|intcomma }}</span></div>
            {% endif %}
            {% if extracted_preview.beds %}
              <div><span class="text-gray-400">Beds:</span> <span class="text-white">{{ extracted_preview.beds }}</span></div>
            {% endif %}
            {% if extracted_preview.baths %}
              <div><span class="text-gray-400">Baths:</span> <span class="text-white">{{ extracted_preview.baths }}</span></div>
            {% endif %}
            {% if extracted_preview.city %}
              <div><span class="text-gray-400">City:</span> <span class="text-white">{{ extracted_preview.city }}</span></div>
            {% endif %}
            {% if extracted_preview.area %}
              <div><span class="text-gray-400">Area:</span> <span class="text-white">{{ extracted_preview.area }}</span></div>
            {% endif %}
          </div>
        </div>
      {% endif %}
      
      <div 
        hx-get="{% url 'import_status' upload.id %}"
        hx-trigger="every 2s"
        hx-swap="outerHTML"
        hx-target="this">
        <!-- Polling will update this -->
      </div>
      
    {% elif upload.status == 'validation' %}
      <div class="mb-6">
        <i class="fas fa-comments text-4xl text-yellow-500 mb-4"></i>
        <h3 class="text-xl font-bold text-white mb-2">Additional Information Needed</h3>
        <p class="text-gray-400">We need a few more details to complete your listing.</p>
      </div>
      
      <a 
        href="{% url 'import_validate' upload.id %}"
        hx-get="{% url 'import_validate' upload.id %}"
        hx-target="#add-property-modal .modal-body"
        hx-swap="innerHTML"
        class="inline-block px-6 py-3 bg-violet-600 hover:bg-violet-700 text-white rounded-lg transition-colors font-semibold">
        Continue Validation
      </a>
      
    {% elif upload.status == 'complete' %}
      {% if upload.property %}
        {% include 'properties/_import_success.html' with property=upload.property %}
      {% else %}
        <div class="mb-6">
          <i class="fas fa-check-circle text-4xl text-green-500 mb-4"></i>
          <h3 class="text-xl font-bold text-white mb-2">Validation Complete!</h3>
          <p class="text-gray-400">Ready to finalize your property listing.</p>
        </div>
        
        <form 
          hx-post="{% url 'import_complete' upload.id %}"
          hx-target="#add-property-modal .modal-body"
          hx-swap="innerHTML">
          {% csrf_token %}
          <button 
            type="submit"
            class="inline-block px-6 py-3 bg-violet-600 hover:bg-violet-700 text-white rounded-lg transition-colors font-semibold">
            Create Property
          </button>
        </form>
      {% endif %}
      
    {% else %}
      <div class="mb-6">
        <i class="fas fa-info-circle text-4xl text-blue-500 mb-4"></i>
        <h3 class="text-xl font-bold text-white mb-2">Status: {{ upload.get_status_display }}</h3>
        <p class="text-gray-400">Upload ID: {{ upload.id }}</p>
      </div>
    {% endif %}
    
    <div class="mt-6 pt-6 border-t border-white/10">
      <button 
        onclick="document.getElementById('add-property-modal').classList.add('hidden');"
        class="text-sm text-gray-400 hover:text-white transition-colors">
        <i class="fas fa-arrow-left mr-2"></i> Go Back
      </button>
    </div>
  </div>
</div>

<script>
// Stop polling if status changes
document.addEventListener('htmx:afterSwap', function(event) {
  if (event.detail.target.classList.contains('status-container')) {
    const status = '{{ upload.status }}';
    if (status !== 'processing') {
      // Stop polling
      htmx.trigger(event.detail.target, 'htmx:abort');
    }
  }
});
</script>

