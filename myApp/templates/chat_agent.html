{% extends 'base_internal.html' %}
{% load static %}

{% block title %}Chat Agent - KaTek AI{% endblock %}

{# No extra_css block â€” fully Tailwind-driven #}

{% block content %}
<div class="relative">
  <!-- Top gradient glow -->
  <div class="pointer-events-none absolute inset-x-0 -top-24 h-48 bg-gradient-to-r from-indigo-500/20 via-fuchsia-500/20 to-cyan-400/20 blur-3xl"></div>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 lg:py-14">
    <!-- Header -->
    <div class="mb-10 lg:mb-12">
      <h1 class="text-3xl sm:text-4xl font-semibold tracking-tight text-white">Chat Agent</h1>
      <p class="mt-2 text-sm sm:text-base text-white/60">Configure your AI agent's personality and behavior</p>
    </div>

    <!-- Main Content -->
    <div class="grid gap-8 lg:grid-cols-2">
      <!-- Live Simulation -->
      <section class="bg-white/5 border border-white/10 rounded-2xl shadow-2xl shadow-black/20 backdrop-blur-xl p-5 sm:p-6 h-fit">
        <div class="flex items-center justify-between pb-4 mb-4 border-b border-white/10">
          <h3 class="text-lg font-semibold text-white">Live Preview</h3>
          <div class="inline-flex items-center gap-2">
            <button type="button" class="device-btn data-[active=false]:bg-white/5 data-[active=false]:border-white/20 data-[active=false]:text-white/70 data-[active=true]:bg-indigo-600 data-[active=true]:border-indigo-600 data-[active=true]:text-white px-3 py-1.5 rounded-md border text-xs font-medium transition" data-active="true" data-device="desktop">
              <i class="fas fa-desktop mr-1"></i> Desktop
            </button>
            <button type="button" class="device-btn data-[active=false]:bg-white/5 data-[active=false]:border-white/20 data-[active=false]:text-white/70 data-[active=true]:bg-indigo-600 data-[active=true]:border-indigo-600 data-[active=true]:text-white px-3 py-1.5 rounded-md border text-xs font-medium transition" data-active="false" data-device="mobile">
              <i class="fas fa-mobile-alt mr-1"></i> Mobile
            </button>
          </div>
        </div>

        <div class="chat-window bg-[#0B0E14] rounded-xl overflow-hidden border border-white/10 shadow-lg flex flex-col h-[520px]">
          <!-- Chat header -->
          <div class="bg-white/5 backdrop-blur-lg border-b border-white/10 px-4 py-3 flex items-center gap-3">
            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-fuchsia-500 grid place-items-center text-white font-semibold">A</div>
            <div>
              <h4 class="text-sm font-medium text-white">Ava from KaTek Realty</h4>
              <p class="text-[11px] text-white/60">Online now</p>
            </div>
          </div>

          <!-- Messages -->
          <div class="flex-1 overflow-y-auto p-3 sm:p-4 space-y-4">
            <!-- AI msg -->
            <div class="message ai flex items-start gap-3 opacity-0 translate-y-5">
              <div class="w-8 h-8 shrink-0 rounded-full bg-white/10 border border-white/20 grid place-items-center text-[11px] text-white">A</div>
              <div class="max-w-[80%] bg-white/5 border border-white/10 rounded-lg px-4 py-3">
                <p class="text-sm leading-relaxed text-white">Hi! I'm Ava from KaTek Realty. How can I help you find your perfect home today?</p>
                <p class="mt-1 text-[10px] text-white/50">2:34 PM</p>
              </div>
            </div>
            <!-- User msg -->
            <div class="message user flex items-start gap-3 justify-end opacity-0 translate-y-5">
              <div class="max-w-[80%] bg-indigo-600 border border-indigo-600 text-white rounded-lg px-4 py-3">
                <p class="text-sm leading-relaxed">I'm looking for a 3BR condo under $500k in downtown</p>
                <p class="mt-1 text-[10px] text-white/80">2:35 PM</p>
              </div>
              <div class="w-8 h-8 shrink-0 rounded-full bg-indigo-600 grid place-items-center text-[11px] text-white">U</div>
            </div>
            <!-- AI msg -->
            <div class="message ai flex items-start gap-3 opacity-0 translate-y-5">
              <div class="w-8 h-8 shrink-0 rounded-full bg-white/10 border border-white/20 grid place-items-center text-[11px] text-white">A</div>
              <div class="max-w-[80%] bg-white/5 border border-white/10 rounded-lg px-4 py-3">
                <p class="text-sm leading-relaxed text-white">Perfect! I found 3 great options in your budget. The newest is a modern 3BR with city views at $485k. Would you like to see the details?</p>
                <p class="mt-1 text-[10px] text-white/50">2:35 PM</p>
              </div>
            </div>
            <!-- User msg -->
            <div class="message user flex items-start gap-3 justify-end opacity-0 translate-y-5">
              <div class="max-w-[80%] bg-indigo-600 border border-indigo-600 text-white rounded-lg px-4 py-3">
                <p class="text-sm leading-relaxed">Yes, that sounds amazing!</p>
                <p class="mt-1 text-[10px] text-white/80">2:36 PM</p>
              </div>
              <div class="w-8 h-8 shrink-0 rounded-full bg-indigo-600 grid place-items-center text-[11px] text-white">U</div>
            </div>
          </div>

          <!-- Input -->
          <div class="px-3 sm:px-4 py-3 border-t border-white/10 flex items-center gap-2">
            <input type="text" placeholder="Type your message..." readonly class="flex-1 bg-white/5 border border-white/20 rounded-md px-3 py-2 text-sm text-white placeholder-white/50 outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500/20">
            <button class="chat-send inline-flex items-center justify-center rounded-md bg-indigo-600 hover:bg-indigo-500 active:bg-indigo-700 px-3 py-2 text-white text-sm transition">
              <i class="fas fa-paper-plane"></i>
            </button>
          </div>
        </div>
      </section>

      <!-- Agent Configuration -->
      <section class="bg-white/5 border border-white/10 rounded-2xl shadow-2xl shadow-black/20 backdrop-blur-xl p-5 sm:p-6">
        <form method="post" class="space-y-8">
          {% csrf_token %}

          <!-- Persona Selection -->
          <div>
            <h3 class="text-lg font-semibold text-white mb-4">Agent Persona</h3>
            <div class="grid sm:grid-cols-2 xl:grid-cols-3 gap-4 mb-2" id="persona-grid">
              <button type="button" data-persona="friendly" class="persona-card group rounded-xl border border-white/10 bg-white/5 p-4 text-left transition hover:border-indigo-500/60 hover:bg-indigo-500/10 focus:outline-none ring-0 data-[selected=true]:border-indigo-500 data-[selected=true]:bg-indigo-500/20" data-selected="true">
                <div class="w-10 h-10 rounded-lg bg-indigo-600 grid place-items-center text-white mb-3"><i class="fas fa-heart"></i></div>
                <h4 class="text-white font-medium">Friendly Consultant</h4>
                <p class="text-white/60 text-sm mt-1">Warm, approachable, and helpful. Perfect for first-time buyers.</p>
              </button>

              <button type="button" data-persona="luxury" class="persona-card group rounded-xl border border-white/10 bg-white/5 p-4 text-left transition hover:border-indigo-500/60 hover:bg-indigo-500/10 focus:outline-none ring-0 data-[selected=true]:border-indigo-500 data-[selected=true]:bg-indigo-500/20" data-selected="false">
                <div class="w-10 h-10 rounded-lg bg-indigo-600 grid place-items-center text-white mb-3"><i class="fas fa-crown"></i></div>
                <h4 class="text-white font-medium">Luxury Expert</h4>
                <p class="text-white/60 text-sm mt-1">Sophisticated and knowledgeable. Ideal for high-end properties.</p>
              </button>

              <button type="button" data-persona="investor" class="persona-card group rounded-xl border border-white/10 bg-white/5 p-4 text-left transition hover:border-indigo-500/60 hover:bg-indigo-500/10 focus:outline-none ring-0 data-[selected=true]:border-indigo-500 data-[selected=true]:bg-indigo-500/20" data-selected="false">
                <div class="w-10 h-10 rounded-lg bg-indigo-600 grid place-items-center text-white mb-3"><i class="fas fa-chart-line"></i></div>
                <h4 class="text-white font-medium">Investor Advisor</h4>
                <p class="text-white/60 text-sm mt-1">Data-driven and analytical. Great for investment properties.</p>
              </button>
            </div>
            <input type="hidden" name="persona" id="selected-persona" value="friendly">
          </div>

          <!-- Tone Sliders -->
          <div>
            <h3 class="text-lg font-semibold text-white mb-4">Tone Adjustment</h3>
            <div class="space-y-6">
              <!-- Slider item -->
              <label class="block">
                <div class="flex items-center justify-between text-white mb-2">
                  <span>Formality</span>
                  <span id="formality-value" class="text-indigo-400 font-semibold">50</span>
                </div>
                <input id="formality-slider" name="formality" type="range" min="0" max="100" value="50" class="w-full accent-indigo-600">
              </label>

              <label class="block">
                <div class="flex items-center justify-between text-white mb-2">
                  <span>Warmth</span>
                  <span id="warmth-value" class="text-indigo-400 font-semibold">70</span>
                </div>
                <input id="warmth-slider" name="warmth" type="range" min="0" max="100" value="70" class="w-full accent-indigo-600">
              </label>

              <label class="block">
                <div class="flex items-center justify-between text-white mb-2">
                  <span>Assertiveness</span>
                  <span id="assertiveness-value" class="text-indigo-400 font-semibold">60</span>
                </div>
                <input id="assertiveness-slider" name="assertiveness" type="range" min="0" max="100" value="60" class="w-full accent-indigo-600">
              </label>
            </div>
          </div>

          <!-- Greeting Text -->
          <div>
            <h3 class="text-lg font-semibold text-white mb-3">Greeting Message</h3>
            <textarea name="greeting" class="w-full min-h-[110px] bg-white/5 border border-white/20 rounded-md px-3 py-2 text-sm text-white placeholder-white/50 outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500/20" placeholder="Hi, I'm Ava from KaTek Realtyâ€”how can I help today?">Hi, I'm Ava from KaTek Realtyâ€”how can I help today?</textarea>
          </div>

          <!-- Knowledge Source -->
          <div>
            <h3 class="text-lg font-semibold text-white mb-4">Knowledge Source</h3>
            <div class="space-y-3" id="knowledge-list">
              <button type="button" data-source="all" class="knowledge-option w-full flex items-start gap-3 rounded-lg border border-white/10 bg-white/5 px-4 py-3 text-left transition hover:border-indigo-500/60 hover:bg-indigo-500/10 data-[selected=true]:border-indigo-500 data-[selected=true]:bg-indigo-500/20" data-selected="true">
                <span class="mt-1 inline-block w-5 h-5 rounded-full border-2 border-white/30 grid place-items-center data-[selected=true]:bg-indigo-600 data-[selected=true]:border-indigo-600">
                  <span class="inner-dot hidden w-2 h-2 rounded-full bg-white" data-selected-dot></span>
                </span>
                <span>
                  <h4 class="text-sm font-semibold text-white">All Properties</h4>
                  <p class="text-xs text-white/60 mt-1">AI can answer questions about any property in your inventory</p>
                </span>
              </button>

              <button type="button" data-source="active" class="knowledge-option w-full flex items-start gap-3 rounded-lg border border-white/10 bg-white/5 px-4 py-3 text-left transition hover:border-indigo-500/60 hover:bg-indigo-500/10" data-selected="false">
                <span class="mt-1 inline-block w-5 h-5 rounded-full border-2 border-white/30 grid place-items-center">
                  <span class="inner-dot hidden w-2 h-2 rounded-full bg-white" data-selected-dot></span>
                </span>
                <span>
                  <h4 class="text-sm font-semibold text-white">Only Active Listings</h4>
                  <p class="text-xs text-white/60 mt-1">AI only knows about currently available properties</p>
                </span>
              </button>

              <button type="button" data-source="rentals" class="knowledge-option w-full flex items-start gap-3 rounded-lg border border-white/10 bg-white/5 px-4 py-3 text-left transition hover:border-indigo-500/60 hover:bg-indigo-500/10" data-selected="false">
                <span class="mt-1 inline-block w-5 h-5 rounded-full border-2 border-white/30 grid place-items-center">
                  <span class="inner-dot hidden w-2 h-2 rounded-full bg-white" data-selected-dot></span>
                </span>
                <span>
                  <h4 class="text-sm font-semibold text-white">Only Rentals</h4>
                  <p class="text-xs text-white/60 mt-1">AI focuses on rental properties only</p>
                </span>
              </button>
            </div>
            <input type="hidden" name="knowledge_source" id="selected-knowledge" value="all">
          </div>

          <!-- Output Controls -->
          <div>
            <h3 class="text-lg font-semibold text-white mb-4">Output Settings</h3>
            <div class="grid sm:grid-cols-2 gap-4">
              <label class="block">
                <span class="block text-sm text-white/80 mb-1">Currency</span>
                <select name="currency" class="w-full bg-white/5 border border-white/20 rounded-md px-3 py-2 text-sm text-white outline-none focus:border-indigo-500">
                  <option value="USD">USD ($)</option>
                  <option value="CAD">CAD (C$)</option>
                  <option value="EUR">EUR (â‚¬)</option>
                </select>
              </label>
              <label class="block">
                <span class="block text-sm text-white/80 mb-1">Units</span>
                <select name="units" class="w-full bg-white/5 border border-white/20 rounded-md px-3 py-2 text-sm text-white outline-none focus:border-indigo-500">
                  <option value="imperial">Imperial (sq ft)</option>
                  <option value="metric">Metric (sq m)</option>
                </select>
              </label>
            </div>
          </div>

          <!-- Integrations -->
          <div class="pt-6 border-t border-white/10">
            <h3 class="text-lg font-semibold text-white mb-4">Integrations</h3>

            <div class="flex items-center justify-between gap-4 rounded-xl border border-white/10 bg-white/5 p-4 mb-3">
              <div>
                <h4 class="text-sm font-semibold text-white">Chat URL</h4>
                <p class="text-xs text-white/60 mt-1">Direct link to your AI agent</p>
              </div>
              <div class="flex items-center gap-2">
                <input type="text" class="url-input bg-white/5 border border-white/20 rounded-md px-3 py-2 text-xs text-white min-w-[220px] outline-none" value="chat.katek.ai/yourcompany" readonly>
                <button type="button" class="copy-btn inline-flex items-center rounded-md bg-indigo-600 hover:bg-indigo-500 active:bg-indigo-700 px-3 py-2 text-xs text-white transition">Copy</button>
              </div>
            </div>

            <div class="flex items-center justify-between gap-4 rounded-xl border border-white/10 bg-white/5 p-4">
              <div>
                <h4 class="text-sm font-semibold text-white">Embed Code</h4>
                <p class="text-xs text-white/60 mt-1">Add to your website</p>
              </div>
              <div class="flex items-center gap-2">
                <input type="text" class="url-input bg-white/5 border border-white/20 rounded-md px-3 py-2 text-xs text-white min-w-[220px] outline-none" value='<script src="chat.katek.ai/embed.js"></script>' readonly>
                <button type="button" class="copy-btn inline-flex items-center rounded-md bg-indigo-600 hover:bg-indigo-500 active:bg-indigo-700 px-3 py-2 text-xs text-white transition">Copy</button>
              </div>
            </div>
          </div>

          <!-- Actions -->
          <div class="flex items-center justify-between pt-6 border-t border-white/10">
            <a href="#" class="text-sm text-white/60 hover:text-white transition">Save as Draft</a>
            <button type="submit" class="inline-flex items-center rounded-lg bg-indigo-600 hover:bg-indigo-500 active:bg-indigo-700 px-5 py-2.5 text-sm font-medium text-white shadow-lg shadow-indigo-900/30 transition">Save Configuration</button>
          </div>
        </form>
      </section>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Persona selection
    const personaCards = document.querySelectorAll('.persona-card');
    const personaHidden = document.getElementById('selected-persona');
    personaCards.forEach(card => {
      card.addEventListener('click', () => {
        personaCards.forEach(c => c.setAttribute('data-selected', 'false'));
        card.setAttribute('data-selected', 'true');
        personaHidden.value = card.dataset.persona;
      });
    });

    // Knowledge source selection
    const knowledgeOptions = document.querySelectorAll('.knowledge-option');
    const selectedKnowledge = document.getElementById('selected-knowledge');
    knowledgeOptions.forEach(option => {
      option.addEventListener('click', () => {
        knowledgeOptions.forEach(o => {
          o.setAttribute('data-selected', 'false');
          const dot = o.querySelector('[data-selected-dot]');
          if (dot) dot.classList.add('hidden');
        });
        option.setAttribute('data-selected', 'true');
        const dot = option.querySelector('[data-selected-dot]');
        if (dot) dot.classList.remove('hidden');
        selectedKnowledge.value = option.dataset.source;
      });
    });

    // Tone sliders
    const sliders = document.querySelectorAll('input[type="range"]');
    sliders.forEach(slider => {
      slider.addEventListener('input', () => {
        const valueEl = document.getElementById(slider.name + '-value');
        if (valueEl) valueEl.textContent = slider.value;
      });
    });

    // Device toggle
    const deviceBtns = document.querySelectorAll('.device-btn');
    const chatWindow = document.querySelector('.chat-window');
    deviceBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        deviceBtns.forEach(b => b.setAttribute('data-active', 'false'));
        btn.setAttribute('data-active', 'true');
        if (btn.dataset.device === 'mobile') {
          chatWindow.style.maxWidth = '380px';
          chatWindow.style.margin = '0 auto';
        } else {
          chatWindow.style.maxWidth = 'none';
          chatWindow.style.margin = '0';
        }
      });
    });

    // Auto-advance messages (hero animation)
    const messages = document.querySelectorAll('.message');
    messages.forEach((m, idx) => {
      setTimeout(() => {
        m.classList.remove('opacity-0');
        m.classList.remove('translate-y-5');
      }, idx * 900 + 400);
    });

    // Copy buttons
    document.querySelectorAll('.copy-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const input = btn.previousElementSibling;
        input.select();
        input.setSelectionRange(0, 99999);
        document.execCommand('copy');
        const original = btn.textContent;
        btn.textContent = 'Copied!';
        btn.classList.remove('bg-indigo-600');
        btn.classList.add('bg-emerald-600');
        setTimeout(() => {
          btn.textContent = original;
          btn.classList.remove('bg-emerald-600');
          btn.classList.add('bg-indigo-600');
        }, 1500);
      });
    });
  });
</script>
{% endblock %}
