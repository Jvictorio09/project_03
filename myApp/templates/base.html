<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Real Estate Leads{% endblock %}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="https://unpkg.com/alpinejs@3.14.1/dist/cdn.min.js" defer></script>
    {% load static %}
    <script src="{% static 'app.js' %}"></script>
    <style>
        [x-cloak] { display: none !important; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navbar -->
    <nav class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <a href="{% url 'home' %}" class="text-2xl font-bold text-orange-600">PropertyHub</a>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="saved-chip bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-sm">Saved (0)</span>
                    <a href="{% url 'book' %}" class="bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 transition">Book a Call</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main>
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8 mt-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center text-sm">
                <p>&copy; 2024 PropertyHub. All rights reserved.</p>
                <div class="mt-2 space-x-4">
                    <a href="#" class="text-gray-300 hover:text-white">Privacy Policy</a>
                    <a href="#" class="text-gray-300 hover:text-white">Terms of Service</a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Capture UTM params on first load
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const utmSource = urlParams.get('utm_source');
            const utmCampaign = urlParams.get('utm_campaign');
            
            if (utmSource && !getCookie('utm_source')) {
                setCookie('utm_source', utmSource, 30);
            }
            if (utmCampaign && !getCookie('utm_campaign')) {
                setCookie('utm_campaign', utmCampaign, 30);
            }
        });

        function setCookie(name, value, days) {
            const expires = new Date();
            expires.setTime(expires.getTime() + (days * 24 * 60 * 60 * 1000));
            document.cookie = name + '=' + value + ';expires=' + expires.toUTCString() + ';path=/';
        }

        function getCookie(name) {
            const value = "; " + document.cookie;
            const parts = value.split("; " + name + "=");
            if (parts.length === 2) return parts.pop().split(";").shift();
        }

        // Global utilities
        window.copyToClipboard = function(text) {
            navigator.clipboard.writeText(text).then(function() {
                // Show a brief notification
                const notification = document.createElement('div');
                notification.className = 'fixed top-4 right-4 bg-green-600 text-white px-4 py-2 rounded-lg shadow-lg z-50';
                notification.textContent = 'Link copied!';
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 2000);
            });
        };

        // HTMX CSRF header
        document.body.addEventListener('htmx:configRequest', function(evt) {
            const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]');
            if (csrfToken) {
                evt.detail.headers['X-CSRFToken'] = csrfToken.value;
            }
        });

        // Analytics events
        document.addEventListener('chat_open', function(event) {
            if (window.dataLayer) {
                window.dataLayer.push({
                    'event': 'chat_open',
                    'property_slug': event.detail?.property_slug || 'unknown'
                });
            }
        });
    </script>
</body>
</html>
