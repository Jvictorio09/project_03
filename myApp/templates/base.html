<!DOCTYPE html>
<html lang="en" x-data="{ mobileOpen:false }" :class="mobileOpen ? 'overflow-hidden' : ''">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{% block title %}Real Estate Leads{% endblock %}</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/htmx.org@1.9.10"></script>
  <script src="https://unpkg.com/alpinejs@3.14.1/dist/cdn.min.js" defer></script>
  
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
  
  {% load static %}
  <script src="{% static 'app.js' %}"></script>
  <style>[x-cloak]{display:none!important}</style>
</head>
<body class="bg-gray-50">
  <!-- Navbar -->
  <nav class="sticky top-0 z-40 bg-white/90 backdrop-blur border-b">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <!-- Brand -->
        <a href="{% url 'home' %}" class="shrink-0 text-xl sm:text-2xl font-bold text-violet-600">
          KaTek Property Hub
        </a>

        <!-- Right side (desktop) -->
        <div class="hidden md:flex items-center gap-3">
          <span class="saved-chip bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-sm">Saved (0)</span>

          <a href="{% url 'results' %}"
             class="inline-flex items-center gap-2 bg-violet-600 text-white px-4 py-2 rounded-lg hover:bg-violet-700 transition">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M4 6h16M4 10h16M4 14h16M4 18h16"></path>
            </svg>
            View All Listings
          </a>

          <a href="{% url 'ai_prompt_listing' %}" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition">AI Listing</a>
          <a href="{% url 'listing_choice' %}" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition">Upload a Listing</a>
          <a href="{% url 'book' %}" class="bg-violet-600 text-white px-4 py-2 rounded-lg hover:bg-violet-700 transition">Book a Call</a>
        </div>

        <!-- Mobile: saved + burger -->
        <div class="flex items-center gap-2 md:hidden">
          <span class="saved-chip bg-gray-100 text-gray-700 px-2.5 py-1 rounded-full text-xs">Saved (0)</span>
          <button type="button"
                  class="inline-flex items-center justify-center w-10 h-10 rounded-lg border border-gray-200 hover:bg-gray-50"
                  @click="mobileOpen = !mobileOpen"
                  :aria-expanded="mobileOpen.toString()"
                  aria-controls="mobile-menu"
                  aria-label="Toggle navigation">
            <svg x-show="!mobileOpen" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M4 6h16M4 12h16M4 18h16"/>
            </svg>
            <svg x-show="mobileOpen" x-cloak class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- Mobile panel -->
    <div id="mobile-menu"
         class="md:hidden border-t bg-white"
         x-show="mobileOpen" x-transition.origin.top x-cloak>
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 grid gap-2">
        <a href="{% url 'results' %}"
           class="w-full inline-flex items-center justify-center gap-2 bg-violet-600 text-white px-4 py-2 rounded-lg hover:bg-violet-700 transition">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M4 6h16M4 12h16M4 18h16"/>
          </svg>
          View All Listings
        </a>
        <a href="{% url 'ai_prompt_listing' %}" class="w-full text-center bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition">AI Listing</a>
        <a href="{% url 'listing_choice' %}" class="w-full text-center bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition">Upload a Listing</a>
        <a href="{% url 'book' %}" class="w-full text-center bg-violet-600 text-white px-4 py-2 rounded-lg hover:bg-violet-700 transition">Book a Call</a>
      </div>
    </div>
  </nav>

  <!-- Main -->
  <main class="min-h-[60vh]">
    {% block content %}{% endblock %}
  </main>

  <!-- Footer -->
  <footer class="bg-gray-800 text-white py-8 mt-16">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center text-sm">
        <p>&copy; 2024 KaTek Property Hub. All rights reserved.</p>
        <div class="mt-2 space-x-4">
          <a href="#" class="text-gray-300 hover:text-white">Privacy Policy</a>
          <a href="#" class="text-gray-300 hover:text-white">Terms of Service</a>
        </div>
      </div>
    </div>
  </footer>

  <!-- Scripts -->
  <script>
    // UTM capture (persist once)
    document.addEventListener('DOMContentLoaded', function() {
      const p = new URLSearchParams(location.search);
      const src = p.get('utm_source');
      const camp = p.get('utm_campaign');
      if (src && !getCookie('utm_source')) setCookie('utm_source', src, 30);
      if (camp && !getCookie('utm_campaign')) setCookie('utm_campaign', camp, 30);
    });

    function setCookie(name, value, days){
      const d = new Date(); d.setTime(d.getTime()+days*864e5);
      document.cookie = name + '=' + encodeURIComponent(value) + ';expires=' + d.toUTCString() + ';path=/;SameSite=Lax';
    }
    function getCookie(name){
      const m = document.cookie.match(new RegExp('(?:^|; )' + name.replace(/([.$?*|{}()[\]\\/+^])/g,'\\$1') + '=([^;]*)'));
      return m ? decodeURIComponent(m[1]) : undefined;
    }

    // HTMX CSRF
    document.body.addEventListener('htmx:configRequest', function(evt){
      const csrf = document.querySelector('[name=csrfmiddlewaretoken]');
      if (csrf) evt.detail.headers['X-CSRFToken'] = csrf.value;
    });

    // Copy helper
    window.copyToClipboard = function(text){
      navigator.clipboard.writeText(text).then(function(){
        const n = document.createElement('div');
        n.className = 'fixed top-4 right-4 bg-blue-600 text-white px-4 py-2 rounded-lg shadow-lg z-50';
        n.textContent = 'Link copied!';
        document.body.appendChild(n);
        setTimeout(()=>n.remove(), 2000);
      });
    };

    // Analytics example
    document.addEventListener('chat_open', function(event){
      if (window.dataLayer){
        window.dataLayer.push({
          event: 'chat_open',
          property_slug: event.detail?.property_slug || 'unknown'
        });
      }
    });

    // Initialize Lucide Icons
    if (typeof lucide !== 'undefined') {
      lucide.createIcons();
    }
  </script>
</body>
</html>
