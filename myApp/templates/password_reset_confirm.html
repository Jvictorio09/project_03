{% extends 'base.html' %}
{% load static %}

{% block title %}Set New Password - KaTek AI{% endblock %}

{% block extra_css %}
<style>
  .reset-container {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: var(--space-8) var(--space-4);
    background: var(--deep-navy);
    position: relative;
    overflow: hidden;
  }
  
  .reset-container::before {
    content: "";
    position: absolute;
    inset: -20%;
    background: conic-gradient(from 180deg at 50% 50%, rgba(139,92,246,.14), rgba(24,175,171,.12), rgba(139,92,246,.14));
    filter: blur(80px);
    opacity: .6;
    animation: aurora 18s linear infinite;
  }
  
  @keyframes aurora {
    to { transform: rotate(360deg); }
  }
  
  .reset-card {
    width: 100%;
    max-width: 400px;
    background: var(--surface-glass);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: var(--radius-xl);
    padding: var(--space-8);
    box-shadow: var(--shadow-soft);
    position: relative;
    z-index: 1;
  }
  
  .reset-header {
    text-align: center;
    margin-bottom: var(--space-8);
  }
  
  .reset-icon {
    width: 64px;
    height: 64px;
    border-radius: var(--radius-xl);
    background: linear-gradient(135deg, var(--primary-purple), var(--electric-violet));
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.5rem;
    margin: 0 auto var(--space-4);
  }
  
  .reset-title {
    font-size: 1.75rem;
    font-weight: var(--font-weight-bold);
    margin: 0 0 var(--space-2) 0;
    color: var(--text-primary);
  }
  
  .reset-subtitle {
    color: var(--text-secondary);
    font-size: 0.875rem;
    margin: 0;
  }
  
  .form-group {
    margin-bottom: var(--space-4);
  }
  
  .form-label {
    display: block;
    margin-bottom: var(--space-2);
    font-size: 0.875rem;
    font-weight: var(--font-weight-medium);
    color: var(--text-primary);
  }
  
  .form-input {
    width: 100%;
    padding: var(--space-3);
    background: var(--surface-glass);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: var(--radius-md);
    color: var(--text-primary);
    font-size: 0.875rem;
    backdrop-filter: blur(10px);
  }
  
  .form-input:focus {
    outline: none;
    border-color: var(--primary-purple);
    box-shadow: 0 0 0 3px rgba(109, 40, 217, 0.1);
  }
  
  .password-field {
    position: relative;
  }
  
  .password-toggle {
    position: absolute;
    right: var(--space-3);
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: var(--text-muted);
    cursor: pointer;
    padding: var(--space-1);
  }
  
  .password-toggle:hover {
    color: var(--text-primary);
  }
  
  .btn-primary {
    width: 100%;
    padding: var(--space-3);
    background: linear-gradient(135deg, var(--primary-purple), var(--electric-violet));
    border: none;
    border-radius: var(--radius-md);
    color: white;
    font-weight: var(--font-weight-bold);
    cursor: pointer;
    transition: all var(--transition-normal);
  }
  
  .btn-primary:hover {
    transform: translateY(-1px);
    box-shadow: 0 8px 25px rgba(109, 40, 217, 0.4);
  }
  
  .btn-ghost {
    width: 100%;
    padding: var(--space-3);
    background: var(--surface-glass);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: var(--radius-md);
    color: var(--text-primary);
    text-decoration: none;
    text-align: center;
    display: block;
    transition: all var(--transition-normal);
  }
  
  .btn-ghost:hover {
    background: var(--surface-glass-hover);
    border-color: rgba(255, 255, 255, 0.3);
  }
  
  .error {
    display: none;
    margin: var(--space-2) 0;
    padding: var(--space-3);
    background: linear-gradient(180deg, rgba(255,82,82,.14), rgba(255,82,82,.08));
    border: 1px solid rgba(255,82,82,.35);
    border-radius: var(--radius-md);
    color: #ff9c9c;
    font-size: 0.875rem;
  }
  
  .error.show {
    display: block;
  }
  
  .success {
    display: none;
    margin: var(--space-2) 0;
    padding: var(--space-3);
    background: linear-gradient(180deg, rgba(16,185,129,.14), rgba(16,185,129,.08));
    border: 1px solid rgba(16,185,129,.35);
    border-radius: var(--radius-md);
    color: #6ee7b7;
    font-size: 0.875rem;
  }
  
  .success.show {
    display: block;
  }
  
  .password-requirements {
    margin-top: var(--space-2);
    font-size: 0.75rem;
    color: var(--text-muted);
  }
  
  @media (prefers-reduced-motion: reduce) {
    .reset-container::before {
      animation: none;
    }
  }
</style>
{% endblock %}

{% block content %}
<div class="reset-container">
  <div class="reset-card">
    <div class="reset-header">
      <div class="reset-icon">
        <i class="fas fa-lock"></i>
      </div>
      <h1 class="reset-title">Set New Password</h1>
      <p class="reset-subtitle">Enter your new password below.</p>
    </div>
    
    {% if messages %}
      {% for message in messages %}
        {% if message.tags == 'error' %}
          <div class="error show" role="alert">{{ message }}</div>
        {% else %}
          <div class="success show" role="alert">{{ message }}</div>
        {% endif %}
      {% endfor %}
    {% endif %}
    
    <form method="post">
      {% csrf_token %}
      
      <div class="form-group">
        <label class="form-label" for="id_password">New Password</label>
        <div class="password-field">
          <input 
            type="password" 
            id="id_password" 
            name="password" 
            class="form-input" 
            placeholder="Enter new password" 
            required
            autocomplete="new-password"
          >
          <button type="button" class="password-toggle" onclick="togglePassword('id_password')">
            <i class="fas fa-eye"></i>
          </button>
        </div>
        <div class="password-requirements">
          Password must be at least 8 characters long
        </div>
      </div>
      
      <div class="form-group">
        <label class="form-label" for="id_password_confirm">Confirm Password</label>
        <div class="password-field">
          <input 
            type="password" 
            id="id_password_confirm" 
            name="password_confirm" 
            class="form-input" 
            placeholder="Confirm new password" 
            required
            autocomplete="new-password"
          >
          <button type="button" class="password-toggle" onclick="togglePassword('id_password_confirm')">
            <i class="fas fa-eye"></i>
          </button>
        </div>
      </div>
      
      <button type="submit" class="btn-primary">
        <i class="fas fa-check"></i>
        Reset Password
      </button>
    </form>
    
    <div style="margin-top: var(--space-6); text-align: center;">
      <a href="{% url 'login' %}" class="btn-ghost">
        <i class="fas fa-arrow-left"></i>
        Back to Login
      </a>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function togglePassword(fieldId) {
  const field = document.getElementById(fieldId);
  const toggle = field.parentElement.querySelector('.password-toggle i');
  
  if (field.type === 'password') {
    field.type = 'text';
    toggle.className = 'fas fa-eye-slash';
  } else {
    field.type = 'password';
    toggle.className = 'fas fa-eye';
  }
}

// Password strength indicator
document.getElementById('id_password').addEventListener('input', function() {
  const password = this.value;
  const requirements = document.querySelector('.password-requirements');
  
  if (password.length >= 8) {
    requirements.style.color = 'var(--success-emerald)';
    requirements.textContent = 'âœ“ Password meets requirements';
  } else {
    requirements.style.color = 'var(--text-muted)';
    requirements.textContent = 'Password must be at least 8 characters long';
  }
});

// Confirm password validation
document.getElementById('id_password_confirm').addEventListener('input', function() {
  const password = document.getElementById('id_password').value;
  const confirm = this.value;
  
  if (confirm && password !== confirm) {
    this.style.borderColor = 'var(--destructive-rose)';
  } else {
    this.style.borderColor = 'rgba(255, 255, 255, 0.2)';
  }
});
</script>
{% endblock %}
